#!/bin/bash

HOST="mafreebox.freebox.fr"
VERSION="0.1"
CONF="${HOME}/.freeboxsnmp"

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
UA="Fbx SNMP Stats v${VERSION}"
C=$(which curl)
CURL="${C} -s -4 -A ${UA}"
API="${DIR}/lib/freeboxos-bash-api/freeboxos_bash_api.sh"

[ ! -x ${C} ] && { echo "Curl is not installed."; exit 1; }
[ -e ${API} ] && source ${API} || { echo "API is not present."; exit 2; }

# Conf management
_reset_conf() {
  echo "APP_NAME=\"fr.freebox.hebeo.snmp\"
APP_FULL_NAME=\"Freebox OS SNMP Bash interface\"
APP_VERSION="${VERSION}"
APP_OS=$(HOSTNAME)
APP_ID=
APP_TOKEN=" >${CONF}
}

[ ! -e ${CONF} ] && { touch ${CONF}; _reset_conf; }
source ${CONF}

if [ "z$APP_ID" == "z" ]; then
  if [ $# -eq 0 ]; then
    echo "You need to call \"$0 auth\"  to initiate App Authorization."
    exit 4
  else
    if [ $1 == "login" ]; then
      # We don't exit if we call login
      echo "" >/dev/null
    elif [ $1 == "auth" ]; then
      # We don't exit if we call auth
      echo "" >/dev/null
    else
      echo "You need to call \"$0 auth\"  to initiate App Authorization."
      exit 8
fi; fi; fi

### Calls

### Main Loop
case $1 in
  version)
    echo ${_API_VERSION}
    ;;
  *)
    echo "Not implemented."
    ;;
esac
