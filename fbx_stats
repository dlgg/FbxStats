#!/bin/bash

HOST="mafreebox.freebox.fr"
VERSION="0.1"
CONF="${HOME}/.freeboxsnmp"

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
UA="Fbx SNMP Stats v${VERSION}"
C=$(which curl)
CURL="${C} -s -4 -A ${UA}"
API="${DIR}/lib/freeboxos-bash-api/freeboxos_bash_api.sh"

[ ! -x ${C} ] && { echo "Curl is not installed."; exit 1; }
[ -e ${API} ] && source ${API} || { echo "API is not present."; exit 2; }

case $(uname) in
  Darwin)
    OS="Mac OSX";;
  Linux)
    OS="Linux";;
  FreeBSD)
    OS="FreeBSD";;
  *)
    OS="Unknown";;
esac

# Conf management
_reset_conf() {
  echo >${CONF} <<__END__
APP_NAME="Freebox.SNMP.app"
APP_FULL_NAME="Freebox OS SNMP Bash interface"
APP_VERSION=${VERSION}
APP_OS=${OS}
APP_ID=
APP_TOKEN=
__END__
}

[ ! -e ${CONF} ] && { touch ${CONF}; _reset_conf; }
source ${CONF}

if [ "z$APP_ID" == "z" ]; then
  if [ $# -eq 0 ]; then
    echo "You need to call \"$0 login\"  to initiate authentication."
    exit 4
  else
    if [ $1 == "login" ]; then
      continue
    else
      echo "You need to call \"$0 login\"  to initiate authentication."
      exit 8
fi; fi; fi

### Calls

### Main Loop
case $1 in
  version)
    echo ${_API_VERSION}
    ;;
  *)
    echo "Not implemented."
    ;;
esac
